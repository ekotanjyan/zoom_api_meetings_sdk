<!DOCTYPE html>
<html>
    <head>
        <!-- import #zmmtg-root css -->
        <link type="text/css" rel="stylesheet" href="https://source.zoom.us/1.7.5/css/bootstrap.css" />
        <link type="text/css" rel="stylesheet" href="https://source.zoom.us/1.7.5/css/react-select.css" />
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <style type="text/css">
           
        </style>
    </head>
    <body>
        <div class="linktoaww" style="
            position: fixed;
            z-index: 9;
            background-color: white;
            padding: 28px;  
            border-radius: 17px;
        "><a href="https://awwapp.com/b/ucpxtw9kigxfg/" target="_blank">GO TO AWW Drawing</a></div>
        <nav id="nav-tool" class=" navbar-fixed-top">
            
            <div class="container">
                <h1>Zoom API Meetings</h1>
                <div class=" col-md-3 alert alert-success d-none" id="autorizationBlock">Authorized with Zoom</div>
                <br><br>
                <a href="https://zoom.us/oauth/authorize?client_id=PNlAN0rQdnFwZXamUcsA&response_type=code&redirect_uri=http%3A%2F%2F127.0.0.1%3A3000%2Fauthorize" id="authorizeBtn" class="btn btn-primary">Authorize with Zoom</a><br>

                
                <button id="createMeeting" class="btn btn-primary d-none">Create Meeting</button><br>
                <button class="btn btn-primary d-none" id="join_meeting">Join</button><br>

            
                
                <!-- <pre id="meetingResponse"></pre><br> -->
               
            </div>
        </nav>


         <!-- import ZoomMtg dependencies -->
         <script src="https://source.zoom.us/1.7.6/lib/vendor/react.min.js"></script>
         <script src="https://source.zoom.us/1.7.6/lib/vendor/react-dom.min.js"></script>
         <script src="https://source.zoom.us/1.7.6/lib/vendor/redux.min.js"></script>
         <script src="https://source.zoom.us/1.7.6/lib/vendor/redux-thunk.min.js"></script>
         <script src="https://source.zoom.us/1.7.6/lib/vendor/jquery.min.js"></script>
         <script src="https://source.zoom.us/1.7.6/lib/vendor/lodash.min.js"></script>
        <!-- import ZoomMtg -->
        <script src="https://source.zoom.us/zoom-meeting-1.7.6.min.js"></script>
        
        <script  src="https://code.jquery.com/jquery-3.5.0.min.js"  integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="  crossorigin="anonymous"></script>
        <script>
            var authorized = "<%= authorized %>";
            if(authorized != 'false')
            {
                $('#autorizationBlock').removeClass('d-none');
                $('#authorizeBtn').addClass('d-none');
                $('#createMeeting').removeClass('d-none');
            }
            var meetingData;
            $(document).ready(function(){              
                $('#createMeeting').on('click', function(){
                    $.get('create_meeting',function(res){
                        if(res)
                        {
                            $('#join_meeting').removeClass('d-none');
                            var objMeetingData = JSON.parse(res.success);
                            var joinURL = objMeetingData.join_url;
                            var win = window.open(joinURL, '_blank');

                            meetingData = objMeetingData;
                           // $('#meetingResponse').text(JSON.stringify(objMeetingData, undefined, 4) );
                        }
                    })
                })

                $('#join_meeting').on('click', function(){
                    const meetConfig = {
                        meetingNumber: meetingData.id,
                        leaveUrl: 'https://yoursite.com/meetingEnd',
                        userName: 'Firstname Lastname',
                        userEmail: 'firstname.lastname@yoursite.com', // required for webinar
                        passWord: meetingData.password, // if required
                        role: 0, // 1 for host; 0 for attendee or webinar
                    };
                    var signature = ZoomMtg.generateSignature({
                            meetingNumber: meetConfig.meetingNumber,
                            apiKey: "PKZFcHNMTTCkQxzHyWolAw",
                            apiSecret: "fSbUMcJPix5Ra2RDU3Cgq3gUpt32LuwKYywE",
                            role: meetConfig.role,
                            success: function(res){
                                console.log(res.result);
                            }
                        });

                        ZoomMtg.init({
                            leaveUrl: 'http://www.zoom.us',
                            isSupportAV: true,
                            success: function () {
                                ZoomMtg.join(
                                    {
                                        meetingNumber: meetConfig.meetingNumber,
                                        userName: meetConfig.userName,
                                        signature: signature,
                                        apiKey: "PKZFcHNMTTCkQxzHyWolAw",
                                        passWord: meetConfig.passWord,
                                        success: function(res){
                                            //$('#nav-tool').hide();
                                            console.log('join meeting success');
                                        },
                                        error: function(res) {
                                            console.log(res);
                                        }
                                    }
                                );
                            },
                            error: function(res) {
                                console.log(res);
                            }
                        });
                    //getSignature(meetConfig)
                })
                
                console.log('checkSystemRequirements');
                console.log(JSON.stringify(ZoomMtg.checkSystemRequirements()));

                // it's option if you want to change the WebSDK dependency link resources. setZoomJSLib must be run at first
                // if (!china) ZoomMtg.setZoomJSLib('https://source.zoom.us/1.7.6/lib', '/av'); // CDN version default
                // else ZoomMtg.setZoomJSLib('https://jssdk.zoomus.cn/1.7.6/lib', '/av'); // china cdn option 
                // ZoomMtg.setZoomJSLib('http://localhost:9999/node_modules/@zoomus/websdk/dist/lib', '/av'); // Local version default, Angular Project change to use cdn version
                ZoomMtg.preLoadWasm();
                ZoomMtg.prepareJssdk();

                ZoomMtg.setZoomJSLib('https://dmogdx0jrul3u.cloudfront.net/1.7.6/lib', '/av'); 
                const zoomMeeting = document.getElementById("zmmtg-root");                
            })
        </script>
    </body>
</html>

